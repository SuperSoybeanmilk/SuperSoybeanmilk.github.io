---
toc: true
#toc_number: 1
title: Unity Mirrorå¤šäººè”æœºæ¡†æ¶åŸºç¡€å¼€å‘
date: 2024-06-17 15:07:00
cover: /img/cover/bq.png
tags:
    - unty
    - Mirror
    - çŠ¶æ€åŒæ­¥
    - å¤šäººè”æœº
---

# ğŸ²å¯¼å…¥èµ„æº

## ğŸ®è·å–Mirrorå¼€å‘åŒ…
å…ˆè¿›[Unityå•†åŸå®˜ç½‘](https://assetstore.unity.com/)é‡Œé¢æœç´¢Mirrorï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ã€‚
![1](1.png)
ç„¶åæ·»åŠ åˆ°æˆ‘çš„èµ„æº

## ğŸ®å¯¼å…¥Mirrorå¼€å‘åŒ…
æ‰“å¼€Unityæ–°å»ºä¸€ä¸ªé»˜è®¤çš„3Dæ¨¡æ¿
![2](2.png)
ç„¶åæ‰“å¼€Windowâ†’Package Manager,åœ¨æ–°çª—å£çš„ä¸Šæ–¹é€‰æ‹©My Assets(å¦‚æœé€‰æ‹©ä»¥åæ˜¾ç¤ºThere are no assets.é‚£å°±ç‚¹ä¸‹é¢çš„åˆ·æ–°å¤šè¯•å‡ æ¬¡),æ‰¾åˆ°Mirroråä¸‹è½½ï¼Œç„¶åå¯¼å…¥ã€‚
![3](3.png)
å¯¼å…¥çš„æ—¶å€™ä¼šé—®ä½ æ˜¯å¦è¦å®‰è£…ä¾èµ–é¡¹ï¼Œé€‰æ‹©å®‰è£…
![4](4.png)
æœ€åç›´æ¥å¯¼å…¥å°±å¯ä»¥
![5](5.png)

# ğŸ²åŸºæœ¬å®ç°

## ğŸ®å»ºç«‹ç®€å•çš„äº¤äº’åœºæ™¯
é¦–å…ˆåœ¨åœºæ™¯é‡Œé¢åˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“ï¼Œç„¶åå‘½åä¸ºNetworkManagerï¼Œä¾æ¬¡æ·»åŠ Network Managerã€Kcp Transportã€NetWork Manager HUDç»„ä»¶
![7](7.png)
ç„¶åæ‰¾åˆ°Network Managerç»„ä»¶çš„Network Infoä¸‹çš„Transportå±æ€§,æŠŠåˆšåˆšåˆ›å»ºçš„NetworkManagerç‰©ä½“æ‹–æ‹½è¿›å»(å› ä¸ºä¹‹å‰è€ç‰ˆæœ¬çš„æ—¶å€™æ·»åŠ Network Managerç»„ä»¶ä¼šè‡ªåŠ¨æ·»åŠ Kcp Transport,å½“å‰è¿™ä¸ªç‰ˆæœ¬ä¸ä¼šè‡ªåŠ¨æ·»åŠ ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ·»åŠ ç„¶åæ‹–æ‹½ä¸Šå»)
![8](8.png)
å¯¼å…¥å…¥ProBuilderæ’ä»¶ï¼ˆç”¨äºå»ºç«‹åŸºç¡€çš„äº¤äº’åœºæ™¯ï¼‰ï¼Œæ–¹æ³•è·Ÿå¯¼å…¥Mirrorçš„æ—¶å€™ä¸€æ ·åªä¸è¿‡ProBuilderåœ¨Unity Registryé‡Œé¢
![9](9.png)
ç„¶åç‚¹å‡»å®‰è£…ï¼Œå®‰è£…å®Œæˆä»¥åç‚¹å‡»Toolsâ†’ProBuilderâ†’ProBuilderWindowæŠŠProBuilderçª—å£æ‰“å¼€ï¼Œæ¥ç€åˆ©ç”¨ProBulideråˆ›å»ºå¥½äº¤äº’åœºæ™¯ï¼Œåšä¸»è¿™è¾¹åšçš„æ¯”è¾ƒç®€å•å°±æ­äº†ä¸ªåœºæ™¯
![11](11.png)
å³å‡»æ–°å»ºç©ºç‰©ä½“å¹¶å‘½åä¸ºStartPointï¼Œç„¶åæ·»åŠ NetWork Start Positionç»„ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯è”æœºæ—¶é‡ç”Ÿç‚¹ï¼Œå¯ä»¥å¤šå»ºå‡ ä¸ªï¼Œåšä¸»è¿™è¾¹å»ºäº†ä¸¤ä¸ªï¼Œç„¶åæ”¾åœ¨ä¸åŒçš„ä½ç½®ï¼ˆåˆ«å¿˜äº†æŠŠYè½´æ”¹ä¸º1è¦ä¸ç„¶ç©å®¶ä¼šæœ‰ä¸€åŠå‡ºç”Ÿå†åœ°åº•ä¸‹ï¼‰ã€‚
![12](12.png)

## ğŸ®Playeræ§åˆ¶å™¨
å¯¼å…¥Cinemachineæ¥ä½œä¸ºç¬¬ä¸‰äººç§°è§†è§’æ§åˆ¶å™¨æ–¹æ³•å’Œä¹‹å‰å¯¼å…¥ProBuliderä¸€æ ·
![14](14.png)
ç”¨ProBuilderå»ºç«‹ä¸€ä¸ªç‰©ä½“å½“Playerï¼ˆåšä¸»æ¯”è¾ƒå–œæ¬¢æ–¹æ–¹æ­£æ­£çš„å°±ç›´æ¥ç”¨æ–¹å—äº†ï¼‰,ç„¶åè¦åšæˆPrefabã€‚
![13](13.png)
å³é”®â†’ChineMachineâ†’CM FreeLookæ¥å»ºç«‹ä¸€ä¸ªç¬¬ä¸‰äººç§°è§†è§’çš„ç›¸æœºï¼Œç„¶åæ‰¾åˆ°Orbitsä¸€æ æŒ‰ç…§ä¸‹å›¾æ–¹å¼ä¿®æ”¹ï¼ˆè¿™ä¸ªæ˜¯æ ¹æ®ç©å®¶æ¨¡å‹æ¥è°ƒæ•´çš„ï¼Œä¸ä¸€å®šè¦è·Ÿåšä¸»çš„ä¸€æ ·ï¼‰
![15](15.png)
æ–°å»ºä¸€ä¸ªè„šæœ¬å«PlayerControlæ¥æ§åˆ¶ç©å®¶
![16](16.png)
è„šæœ¬å¦‚ä¸‹åˆ«å¿˜äº†æŠŠMonoBehaviouræ”¹æˆNetworkBehaviour
```
using Mirror;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Cinemachine;
using UnityEngine.UI;

public class PlayerControl : NetworkBehaviour
{

    /// <summary>
    /// ç§»åŠ¨é€Ÿåº¦
    /// </summary>
    public float moveSpeed = 5;
    /// <summary>
    /// æ‘„åƒæœº
    /// </summary>
    [HideInInspector]
    public Transform cameraTransfrom;
    [HideInInspector]
    public float currentVelocity;
    /// <summary>
    /// äººç‰©è½¬å‘å¹³æ»‘å€¼
    /// </summary>
    public float smoothTime = 0.3f;
    /// <summary>
    /// ç¬¬ä¸‰äººç§°æ‘„åƒæœº
    /// </summary>
    [HideInInspector]
    public CinemachineFreeLook playerCamera;

    public override void OnStartLocalPlayer()
    {

        //å°†ä¸»ç›¸æœºç»‘å®š
        cameraTransfrom = Camera.main.transform;
        playerCamera = GameObject.Find("CM FreeLook").GetComponent<CinemachineFreeLook>();
        playerCamera.Follow = transform;
        playerCamera.LookAt = transform;
        playerCamera.m_YAxis.Value = 1f;

        CursorHideAndCenter();

    }

    // Update is called once per frame
    void Update()
    {

        //å¦‚æœä¸æ˜¯å®¢æˆ·ç«¯å°±ä¸èµ°
        if (!isLocalPlayer)
        {
            return;
        }

        //è·å–æ˜¯å¦æœ‰ç§»åŠ¨é”®è¾“å…¥
        Vector2 input = new Vector2(Input.GetAxisRaw("Horizontal"), Input.GetAxisRaw("Vertical"));
        Vector2 inputDir = input.normalized;
        //è·å–æ—‹è½¬è§’åº¦
        float targetRotation = Mathf.Atan2(inputDir.x, inputDir.y) * Mathf.Rad2Deg + cameraTransfrom.eulerAngles.y;
        //å¦‚æœè§¦å‘äº†æŒ‰é”®
        if (inputDir != Vector2.zero)
        {
            transform.eulerAngles = Vector3.up * Mathf.SmoothDampAngle(transform.eulerAngles.y, targetRotation, ref currentVelocity, smoothTime);
            transform.Translate(transform.forward * moveSpeed * Time.deltaTime, Space.World);
        }

    }

    /// <summary>
    /// æ‘„åƒæœºåœæ­¢ç§»åŠ¨
    /// </summary>
    public void CameraStop()
    {
        playerCamera.m_YAxis.m_MaxSpeed = 0;
        playerCamera.m_XAxis.m_MaxSpeed = 0;
    }

    /// <summary>
    /// æ‘„åƒæœºå¼€å§‹ç§»åŠ¨
    /// </summary>
    public void CameraStart()
    {
        playerCamera.m_YAxis.m_MaxSpeed = 3;
        playerCamera.m_XAxis.m_MaxSpeed = 300;
    }

    /// <summary>
    /// éšè—å¹¶é”å®šé¼ æ ‡
    /// </summary>
    public void CursorHideAndCenter()
    {
        Cursor.lockState = CursorLockMode.Locked;
        Cursor.visible = false;
    }

    /// <summary>
    /// æ˜¾ç¤ºå¹¶è§£é”é¼ æ ‡
    /// </summary>
    public void CursorShow()
    {
        Cursor.lockState = CursorLockMode.None;
        Cursor.visible = true;
    }

}
```
ç¼–è¾‘Playeré¢„åˆ¶ä½“ï¼Œæ·»åŠ Network Identityç»„ä»¶å’ŒNetwork Transform(Reliable)ç»„ä»¶ï¼Œå¹¶æŠŠåˆšåˆšå†™çš„è„šæœ¬é™„ä¸Šå»
![17](17.png)
å†ä»åœºæ™¯ä¸­æŠŠplayeré¢„åˆ¶ä½“åˆ é™¤ï¼Œä¹‹åå†æ‰¾åˆ°NetworkManageræŠŠå½“å‰åœºæ™¯èµ‹äºˆåˆ°OfficeSceneå’ŒOnlineSceneä¸Šï¼ŒæŠŠPlayeré¢„åˆ¶ä½“èµ‹äºˆåˆ°Player Prefabä¸Š
![18](18.png)

## ğŸ®å‘å¸ƒæµ‹è¯•
æœ€åå°±æ˜¯å‘å¸ƒæµ‹è¯•äº†ï¼Œå…ˆæ‰“åŒ…ä¸€ä¸ªwindowsç¨‹åºå‡ºæ¥ï¼Œç„¶åipconfigæŸ¥ä¸€ä¸‹è‡ªå·±ç”µè„‘å½“å‰ipæ˜¯å¤šå°‘ã€‚å…ˆå¯åŠ¨ç¼–è¾‘å™¨å†…çš„åœºæ™¯ç‚¹å‡»Hostï¼ˆSever+Clientï¼‰è¿™ä¸ªæŒ‰é’®å°±å¯ä»¥ä½œä¸ºæœåŠ¡ç«¯å¯åŠ¨ï¼ˆä¸‹é¢ä¸è¦å¡«localhostå¡«è‡ªå·±çš„ipï¼Œå¦åˆ™ä¸èµ·ä½œç”¨ï¼‰ã€‚
![19](19.png)
ç„¶åå†å¯åŠ¨åˆšåˆšæ‰“åŒ…å‡ºæ¥çš„å®¢æˆ·ç«¯ï¼Œè¾“å…¥ipç„¶åç‚¹Client
![22](22.png)
è¿™ä¸ªæ—¶å€™å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†
![21](21.png)
